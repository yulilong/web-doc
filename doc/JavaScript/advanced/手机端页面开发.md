[TOC]

## 1. 高清方案布局代码

这是阿里团队的高清方案布局代码，所谓高清方案就是利用rem的特性（我们知道默认情况下html的1rem = 16px），根据设备屏幕的DPR（设备像素比，又称DPPX，比如dpr=2时，表示1个CSS像素由4个物理像素点组成）**根据设备DPR调整页面的压缩比率（即：1/dpr），同时动态设置 html 的font-size为（50 \* dpr)，进而达到高清效果**。

 ```html
<script>!function(e){function t(a){if(i[a])return i[a].exports;var n=i[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=window;t["default"]=i.flex=function(normal,e,t){var a=e||100,n=t||1,r=i.document,o=navigator.userAgent,d=o.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i),l=o.match(/U3\/((\d+|\.){5,})/i),c=l&&parseInt(l[1].split(".").join(""),10)>=80,p=navigator.appVersion.match(/(iphone|ipad|ipod)/gi),s=i.devicePixelRatio||1;p||d&&d[1]>534||c||(s=1);var u=normal?1:1/s,m=r.querySelector('meta[name="viewport"]');m||(m=r.createElement("meta"),m.setAttribute("name","viewport"),r.head.appendChild(m)),m.setAttribute("content","width=device-width,user-scalable=no,initial-scale="+u+",maximum-scale="+u+",minimum-scale="+u),r.documentElement.style.fontSize=normal?"50px": a/2*s*n+"px"},e.exports=t["default"]}]);  flex(false,100, 1);</script>

 ```

### 代码原理

这是阿里团队的高清方案布局代码，所谓高清方案就是利用rem的特性（我们知道默认情况下html的1rem = 16px），根据设备屏幕的DPR（设备像素比，又称DPPX，比如dpr=2时，表示1个CSS像素由4个物理像素点组成）**根据设备DPR调整页面的压缩比率（即：1/dpr），同时动态设置 html 的font-size为（50 \* dpr)，进而达到高清效果**。

源码：**绝不是每个地方都要用rem，rem只适用于固定尺寸！**

```javascript
'use strict';

/**
 * @param {Boolean} [normal = false] - 默认开启页面压缩以使页面高清;  
 * @param {Number} [baseFontSize = 100] - 基础fontSize, 默认100px;
 * @param {Number} [fontscale = 1] - 有的业务希望能放大一定比例的字体;
 */
const win = window;
export default win.flex = (normal, baseFontSize, fontscale) => {
  const _baseFontSize = baseFontSize || 100;
  const _fontscale = fontscale || 1;

  const doc = win.document;
  const ua = navigator.userAgent;
  const matches = ua.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i);
  const UCversion = ua.match(/U3\/((\d+|\.){5,})/i);
  const isUCHd = UCversion && parseInt(UCversion[1].split('.').join(''), 10) >= 80;
  const isIos = navigator.appVersion.match(/(iphone|ipad|ipod)/gi);
  let dpr = win.devicePixelRatio || 1;
  if (!isIos && !(matches && matches[1] > 534) && !isUCHd) {
    // 如果非iOS, 非Android4.3以上, 非UC内核, 就不执行高清, dpr设为1;
    dpr = 1;
  }
  const scale = normal ? 1 : 1 / dpr;

  let metaEl = doc.querySelector('meta[name="viewport"]');
  if (!metaEl) {
    metaEl = doc.createElement('meta');
    metaEl.setAttribute('name', 'viewport');
    doc.head.appendChild(metaEl);
  }
  metaEl.setAttribute('content', `width=device-width,user-scalable=no,initial-scale=${scale},maximum-scale=${scale},minimum-scale=${scale}`);
  doc.documentElement.style.fontSize = normal ? '50px' : `${_baseFontSize / 2 * dpr * _fontscale}px`;
};
```

## 2. 手机浏览器兼容性

### 2.1 部分手机浏览器不支持dom类数组的forEach功能

我在开发的过程中，使用` document.querySelectorAll(".tab .tab-header>li")`获取一组类数组对象的时候，使用`forEach`遍历每个对象的时候，在一些旧版本的手机浏览器中发现出错：

```java
var tabHeaders = document.querySelectorAll(".tab .tab-header>li");
tabHeaders.forEach(function(tab){
   tab.onclick = function() {
       // 做一些操作
   }
}
```

上面的代码在UC浏览器手机版本(V11.9.6.1) 会报错。想要遍历可以使用for循环：

```java
for (var i = 0; i < tabHeaders.length; i++) {
    tabHeaders[i].onclick = function() {
        // 做一些操作
    }
}
```

### 2.2 部分手机浏览器不支持ES6语法高级语法

在开发的时候在代码中使用了`let`变量，但是在部分浏览器(华为手机自带浏览器2018-06-06)中发现出错，导致整个JS文件都没有执行：

```javascript
for (let i = 0; i < tabHeaders.length; i++) {}
```

上面的代码for循环中使用了let声明变量，导致我在华为手机自带的浏览器中页面没有执行JS文件。 解决办法是把`let` 换成`var`，即可。

还有ES6的字符串:

```javascript
var str = `1、挖掘用户需求，收集数据反馈，进行数据分析 <br>
2、参与课程信息收集、研发工作
`
```

这样的字符串也会在华为自带浏览器报错，可以把多行字符串写成下面：

```javascript
var str = "1、北京高校在校生，专业不限，一周可实习至少4天，能够全职实习最好 	<br>\
2、工作踏实、细致、耐心、积极、负责，学习能力强，拥抱变化 	<br>\
3、良好的团队合作意识和创新意识<br>\
"
```

所以为了兼容性，页面中的JS中不要是用ES6以上的高级语法。

## 其他功能

### 1. 禁止手机横屏

有时希望手机禁止横屏浏览网页，而横屏这个功能一般在手机或手机浏览器上设置，作为网页是没有权限去操作这个设置了。

那么页面中发现是横屏的办法：

- 通过判断窗口宽高值的比值判断是否横屏

  对于正常手机屏幕来说，窗口宽度是小于窗口高度的，即 宽度/高度 的值是小于 1 的，那么如果手机横屏了呢，窗口原本的宽度变成了高度，原本的高度变成了宽度，此时， 宽高比就大于 1 了。以此来判断手机是否横屏。

  ```javascript
  function rotate (){
      if(document.documentElement.clientWidth > document.documentElement.clientHeight){
          alert('横屏了');
      }else{
          alert('没有横屏');
      }
  }
  window.onload = rotate;
  window.onresize = rotate;
  ```

  但是，对于手机端的页面 ，一般 window.onload 和 window.onresize 两个事件都会被占用来做其他的事情，如果想这样写，就得在js中穿插 rotate 函数中的代码，使代码变得不那么规整。

- 通过 orientationchange 事件判断是否横屏

  orientationchange 为html5的新特性，是在用户水平或者垂直翻转设备（即方向发生变化）时触发的事件，而且这个事件一般不会被占用。

  核心代码如下：

  ```javascript
  window.onorientationchange=function(){
      if(window.orientation==90||window.orientation==-90){
          alert('横屏了');
      }else{
          alert('没有横屏');
      }
  }
  ```

  我们可以利用这个方法封装成一个自执行的js ，只要有用到，直接引用就可以了

  参考资料：[移动端开发-禁止横屏](https://www.cnblogs.com/hanguozhi/p/7405840.html)

  



## 参考资料

[手机端页面自适应解决方案—rem布局进阶版（附源码示例）](https://www.jianshu.com/p/985d26b40199)

[JS来判断页面是在手机端还是在PC端打开的方法](https://blog.csdn.net/a419419/article/details/78752417)

[简单的利用JS来判断页面是在手机端还是在PC端打开的方法](https://www.cnblogs.com/gaohuijiao/p/6736155.html)

[手机浏览器User-Agent信息](https://blog.csdn.net/ccclll1990/article/details/17006159)

[手机版头部声明细则 CSDN](https://blog.csdn.net/ft2166826/article/details/49833563)

[移动前端常用的html5 head标签](https://www.jianshu.com/p/f7f7307ee021)